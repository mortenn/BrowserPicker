<UserControl 
	x:Class="BrowserPicker.View.Configuration"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:converter="clr-namespace:BrowserPicker.Converter"
	xmlns:view="clr-namespace:BrowserPicker.View"
	xmlns:viewModel="clr-namespace:BrowserPicker.ViewModel"
	xmlns:browserPicker="clr-namespace:BrowserPicker;assembly=BrowserPicker.Common"
	xmlns:system="clr-namespace:System;assembly=mscorlib"
	xmlns:app="clr-namespace:BrowserPicker"
	mc:Ignorable="d"
	d:DataContext="{d:DesignInstance viewModel:ConfigurationViewModel,d:IsDesignTimeCreatable=True}"
	HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
	d:Height="400" d:Width="600">
	<UserControl.Resources>
		<ResourceDictionary>
			<!-- Tabs: visible header with border/background, compact, selected tab joins content area. -->
			<Style TargetType="TabItem" BasedOn="{StaticResource {x:Type TabItem}}">
				<Setter Property="Foreground" Value="{DynamicResource {x:Static app:App.ContentForegroundBrushKey}}" />
				<Setter Property="Padding" Value="8,4" />
				<Setter Property="Margin" Value="0,0,1,0" />
				<Setter Property="Background" Value="{DynamicResource {x:Static app:App.ContentBackgroundBrushKey}}" />
				<Setter Property="BorderBrush" Value="{DynamicResource {x:Static app:App.ContentForegroundBrushKey}}" />
				<Setter Property="BorderThickness" Value="1,1,1,0" />
				<Setter Property="Template">
					<Setter.Value>
						<ControlTemplate TargetType="TabItem">
							<Border x:Name="Border" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}"
								BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}"
								Margin="{TemplateBinding Margin}" CornerRadius="3,3,0,0">
								<ContentPresenter ContentSource="Header" HorizontalAlignment="Center" VerticalAlignment="Center" />
							</Border>
							<ControlTemplate.Triggers>
								<Trigger Property="IsSelected" Value="True">
									<Setter TargetName="Border" Property="Panel.ZIndex" Value="1" />
									<Setter TargetName="Border" Property="Margin" Value="0,0,1,-1" />
									<Setter TargetName="Border" Property="BorderThickness" Value="1,1,1,0" />
								</Trigger>
							</ControlTemplate.Triggers>
						</ControlTemplate>
					</Setter.Value>
				</Setter>
				<Style.Triggers>
					<Trigger Property="IsSelected" Value="True">
						<Setter Property="Panel.ZIndex" Value="1" />
						<Setter Property="Margin" Value="0,0,1,-1" />
					</Trigger>
				</Style.Triggers>
			</Style>
			<Style TargetType="TabControl" BasedOn="{StaticResource {x:Type TabControl}}">
				<Setter Property="Padding" Value="4,0,4,4" />
			</Style>
			<Style TargetType="CheckBox" BasedOn="{StaticResource {x:Type CheckBox}}">
				<Setter Property="Foreground" Value="{DynamicResource {x:Static app:App.ContentForegroundBrushKey}}" />
			</Style>
			<Style TargetType="RadioButton" BasedOn="{StaticResource {x:Type RadioButton}}">
				<Setter Property="Foreground" Value="{DynamicResource {x:Static app:App.ContentForegroundBrushKey}}" />
			</Style>

			<converter:IconFileToImageConverter x:Key="IconConverter" />

			<ObjectDataProvider x:Key="ThemeModes" MethodName="GetValues" ObjectType="{x:Type system:Enum}">
				<ObjectDataProvider.MethodParameters>
					<x:Type TypeName="browserPicker:ThemeMode"/>
				</ObjectDataProvider.MethodParameters>
			</ObjectDataProvider>

			<DataTemplate x:Key="BrowserIcon" DataType="{x:Type viewModel:BrowserViewModel}">
				<Image Margin="0,0,0,0" DataContext="{Binding Model.IconPath, Converter={StaticResource IconConverter}}" d:DataContext="{DynamicResource DefaultIcon}">
					<Image.Style>
						<Style TargetType="{x:Type Image}">
							<Setter Property="Source" Value="{Binding}" />
							<Style.Triggers>
								<DataTrigger Binding="{Binding}" Value="{x:Null}">
									<Setter Property="Source" Value="{DynamicResource DefaultIcon}" />
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</Image.Style>
				</Image>
			</DataTemplate>

			<DataTemplate x:Key="BrowserIconAndName" DataType="viewModel:BrowserViewModel">
				<StackPanel Orientation="Horizontal">
					<ContentPresenter ContentTemplate="{StaticResource BrowserIcon}" VerticalAlignment="Center" />
					<TextBlock Padding="5,0,0,0" Text="{Binding Model.Name}" VerticalAlignment="Center" />
				</StackPanel>
			</DataTemplate>
			<!-- Icon + name for use in compact dropdowns (add-default row, etc.) with a visible icon size -->
			<DataTemplate x:Key="BrowserIconAndNameCombo" DataType="viewModel:BrowserViewModel">
				<StackPanel Orientation="Horizontal">
					<ContentPresenter ContentTemplate="{StaticResource BrowserIcon}" VerticalAlignment="Center" Width="20" Height="20" />
					<TextBlock Padding="6,0,0,0" Text="{Binding Model.Name}" VerticalAlignment="Center" />
				</StackPanel>
			</DataTemplate>
		</ResourceDictionary>
	</UserControl.Resources>

	<Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
		Background="{DynamicResource {x:Static app:App.ContentBackgroundBrushKey}}"
		TextElement.Foreground="{DynamicResource {x:Static app:App.ContentForegroundBrushKey}}">
		<Grid.RowDefinitions>
			<RowDefinition Height="*" />
			<RowDefinition Height="auto" />
		</Grid.RowDefinitions>

		<TabControl HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
			Background="{DynamicResource {x:Static app:App.ContentBackgroundBrushKey}}">
			<TabControl.Style>
				<Style TargetType="TabControl">
					<Setter Property="SelectedIndex" Value="1" />
					<Style.Triggers>
						<DataTrigger Binding="{Binding Welcome}" Value="True">
							<Setter Property="SelectedIndex" Value="0" />
						</DataTrigger>
					</Style.Triggers>
				</Style>
			</TabControl.Style>

			<TabItem Header="Welcome">
				<TabItem.Style>
					<Style TargetType="TabItem" BasedOn="{StaticResource {x:Type TabItem}}">
						<Setter Property="Visibility" Value="Collapsed" />
						<Style.Triggers>
							<DataTrigger Binding="{Binding Welcome}" Value="True">
								<Setter Property="Visibility" Value="Visible" />
							</DataTrigger>
						</Style.Triggers>
					</Style>
				</TabItem.Style>
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="4">
				<TextBlock Margin="4" TextWrapping="Wrap" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" FontWeight="Light">
					Welcome to Browser Picker, hope you enjoy my little app!<LineBreak />
					I've gone ahead and opened up the settings window,<LineBreak />
					so you can have a look around before you get started :)
					<LineBreak />
					<LineBreak />
					Please give it a ‚≠ê on GitHub, so you will get notified when a new release is made.
					<LineBreak />
					<LineBreak />
					Should you run into any kind of trouble or get an idea,<LineBreak />
					please visit <Hyperlink Foreground="{DynamicResource {x:Static SystemColors.HotTrackBrushKey}}">github.com/mortenn/BrowserPicker</Hyperlink> and file an issue!<LineBreak />
					<LineBreak />
					Be seeing you!
					<LineBreak />
					<LineBreak />
					<Run FontSize="8">This message will self-destruct in 10 seconds</Run>
				</TextBlock>
				</ScrollViewer>
			</TabItem>

			<TabItem Header="Browsers">
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<ScrollViewer VerticalScrollBarVisibility="Auto">
						<ItemsControl ItemsSource="{Binding ParentViewModel.Choices}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<StackPanel Orientation="Vertical" CanVerticallyScroll="True" />
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate DataType="viewModel:BrowserViewModel">
									<Grid>
										<Grid.Style>
											<Style>
												<Setter Property="UIElement.Visibility" Value="Visible" />
												<Style.Triggers>
													<DataTrigger Binding="{Binding Model.Removed}" Value="True">
														<Setter Property="UIElement.Visibility" Value="Collapsed" />
													</DataTrigger>
												</Style.Triggers>
											</Style>
										</Grid.Style>
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="Auto" />
											<ColumnDefinition Width="*" />
											<ColumnDefinition Width="Auto" />
											<ColumnDefinition Width="Auto" />
											<ColumnDefinition Width="Auto" />
											<ColumnDefinition Width="Auto" />
											<ColumnDefinition Width="Auto" />
										</Grid.ColumnDefinitions>
										<ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource BrowserIcon}" Height="40" Width="40" Margin="20,0,0,0" />
										<TextBlock Text="{Binding Model.Name}" Grid.Column="1"  Margin="10" FontSize="18" />
										<Grid Grid.Column="2" VerticalAlignment="Center">
											<Grid.Style>
												<Style TargetType="Grid">
													<Style.Triggers>
														<DataTrigger Binding="{Binding IsManuallyOrdered}" Value="False">
															<Setter Property="Visibility" Value="Collapsed" />
														</DataTrigger>
													</Style.Triggers>
												</Style>
											</Grid.Style>
											<Grid.RowDefinitions>
												<RowDefinition Height="Auto" />
												<RowDefinition Height="Auto" />
											</Grid.RowDefinitions>
											<TextBlock FontSize="10"><Hyperlink TextDecorations="None" Command="{Binding MoveUp}">üîº</Hyperlink></TextBlock>
											<TextBlock FontSize="10" Grid.Row="1"><Hyperlink TextDecorations="None" Command="{Binding MoveDown}">üîΩ</Hyperlink></TextBlock>
										</Grid>
										<TextBlock Grid.Column="3" Margin="10" FontSize="16">
										<Hyperlink Command="{Binding Disable}">
											<TextBlock>
													<TextBlock.Style>
														<Style>
															<Setter Property="TextBlock.Foreground" Value="Green" />
															<Setter Property="TextBlock.Text" Value="Enabled" />
															<Style.Triggers>
																<DataTrigger Binding="{Binding Model.Disabled}" Value="True">
																	<Setter Property="TextBlock.Foreground" Value="OrangeRed" />
																	<Setter Property="TextBlock.Text" Value="Disabled" />
																</DataTrigger>
															</Style.Triggers>
														</Style>
													</TextBlock.Style>
											</TextBlock>
										</Hyperlink>
									</TextBlock>
										<TextBlock Grid.Column="4" Margin="10" FontSize="16">
										<Hyperlink Command="{Binding Edit}">
											<TextBlock Text="Edit" Foreground="CadetBlue" ToolTip="Edit browser definition" />
										</Hyperlink>
									</TextBlock>
										<TextBlock Grid.Column="5" Margin="10" FontSize="16">
										<Hyperlink Command="{Binding Duplicate}">
											<TextBlock Text="+" Foreground="LightGreen" ToolTip="Duplicate browser: create a new browser using this browser as a starting point" />
										</Hyperlink>
									</TextBlock>
										<TextBlock Grid.Column="6" Margin="10" FontSize="16">
										<Hyperlink Command="{Binding Remove}">
											<TextBlock Text="X" Foreground="Red" ToolTip="Remove browser from list" />
										</Hyperlink>
									</TextBlock>
									</Grid>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
					<StackPanel Grid.Row="1" Orientation="Horizontal" Margin="4">
						<TextBlock>
							<Hyperlink Command="{Binding AddBrowser}" >
								<TextBlock Text="Add browser" />
							</Hyperlink>
						</TextBlock>

						<TextBlock Margin="10,0,0,0">
							<Hyperlink Command="{Binding RefreshBrowsers}" >
								<TextBlock Text="Refresh browser list" />
							</Hyperlink>
						</TextBlock>
					</StackPanel>
				</Grid>
				</ScrollViewer>
			</TabItem>

			<TabItem Header="Behaviour">
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="4">
				<Grid>
					<Grid.Resources>
						<Style TargetType="{x:Type CheckBox}" BasedOn="{StaticResource {x:Type CheckBox}}">
							<Setter Property="Margin" Value="5,0,0,5"/>
						</Style>
					</Grid.Resources>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*" MinWidth="260" />
						<ColumnDefinition Width="*" MinWidth="260" />
					</Grid.ColumnDefinitions>

					<!-- Left: Appearance & list order -->
					<StackPanel Grid.Column="0" Margin="0,0,16,0">
						<TextBlock Text="Appearance" FontWeight="Bold" Margin="0,4,0,6" />
						<StackPanel Orientation="Horizontal" Margin="0,0,0,8">
							<TextBlock Text="Theme: " VerticalAlignment="Center" />
							<ComboBox ItemsSource="{Binding Source={StaticResource ThemeModes}}"
								SelectedItem="{Binding Settings.ThemeMode}"
								Width="120" VerticalAlignment="Center" />
						</StackPanel>
						<StackPanel Orientation="Horizontal" Margin="0,0,0,8">
							<TextBlock Text="Font size: " VerticalAlignment="Center" />
							<TextBox Text="{Binding Settings.FontSize, UpdateSourceTrigger=PropertyChanged}" MinWidth="50" MinHeight="28" Padding="6,4" VerticalAlignment="Center" VerticalContentAlignment="Center" />
							<TextBlock Text=" px" VerticalAlignment="Center" Margin="2,0,0,0" />
						</StackPanel>
						<CheckBox Content="Auto size window" IsChecked="{Binding Settings.AutoSizeWindow}" ToolTip="When checked, the window fits its content. When unchecked, the window uses the last size you set by resizing. Resize the window to fix a size; that turns this off and saves the size." />
						<CheckBox Content="Turn off transparency" IsChecked="{Binding Settings.DisableTransparency}" />
						<StackPanel Orientation="Horizontal" Margin="0,4,0,0">
							<StackPanel.Style>
								<Style>
									<Setter Property="UIElement.IsEnabled" Value="True" />
									<Style.Triggers>
										<DataTrigger Binding="{Binding Settings.DisableTransparency}" Value="True">
											<Setter Property="UIElement.IsEnabled" Value="False" />
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</StackPanel.Style>
							<TextBlock Text="Window opacity: " VerticalAlignment="Center" />
							<Slider Minimum="0.5" Maximum="1" Value="{Binding Settings.WindowOpacity, UpdateSourceTrigger=Default}" Width="120" VerticalAlignment="Center" Margin="4,0" />
							<TextBlock Text="{Binding Settings.WindowOpacity, StringFormat=P0}" VerticalAlignment="Center" MinWidth="32" />
						</StackPanel>

						<TextBlock Text="List order" FontWeight="Bold" Margin="0,16,0,6" />
						<RadioButton GroupName="OrderBy" Content="Sort list manually" IsChecked="{Binding Settings.UseManualOrdering}" Margin="0,2" />
						<RadioButton GroupName="OrderBy" Content="Sort list based on usage" IsChecked="{Binding Settings.UseAutomaticOrdering}" Margin="0,2" />
						<RadioButton GroupName="OrderBy" Content="Sort list alphabetically" IsChecked="{Binding Settings.UseAlphabeticalOrdering}" Margin="0,2,0,6" />
					</StackPanel>

					<!-- Right: Selection & defaults -->
					<StackPanel Grid.Column="1">
						<TextBlock Text="When to show the picker" FontWeight="Bold" Margin="0,4,0,6" />
						<CheckBox Content="Always show browser selection window" IsChecked="{Binding Settings.AlwaysPrompt}" />
						<CheckBox Content="Always ask when no default is matching url" IsChecked="{Binding Settings.AlwaysAskWithoutDefault}" />
						<CheckBox Content="Use defaults even when browser is not running" IsChecked="{Binding Settings.AlwaysUseDefaults}"
							ToolTip="When unchecked, the selection window appears if your default browser is not running. Check this to always open links in your default (or fallback) browser without showing the selection window." />

						<TextBlock Text="When no URL rule matches" FontWeight="Bold" Margin="0,16,0,6" />
						<CheckBox Content="Use a fallback default browser" IsChecked="{Binding Settings.UseFallbackDefault}"
							ToolTip="When checked, links that match no rule open in the browser you select below. When unchecked, the picker is shown (or you are asked) depending on other settings." />
						<StackPanel Margin="20,4,0,0">
							<StackPanel.Style>
								<Style>
									<Setter Property="UIElement.IsEnabled" Value="True" />
									<Style.Triggers>
										<DataTrigger Binding="{Binding Settings.UseFallbackDefault}" Value="False">
											<Setter Property="UIElement.IsEnabled" Value="False" />
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</StackPanel.Style>
							<StackPanel Orientation="Horizontal">
								<TextBlock Text="Fallback browser: " VerticalAlignment="Center" />
								<ComboBox
									ItemsSource="{Binding ParentViewModel.Choices}"
									ItemTemplate="{StaticResource BrowserIconAndName}"
									IsSynchronizedWithCurrentItem="False"
									SelectedValuePath="Model.Id"
									SelectedValue="{Binding Settings.DefaultBrowser}"
									MinWidth="180" MinHeight="28" VerticalAlignment="Center" />
							</StackPanel>
						</StackPanel>

						<TextBlock Text="Network" FontWeight="Bold" Margin="0,16,0,6" />
						<CheckBox Content="Disallow network activity" IsChecked="{Binding Settings.DisableNetworkAccess}" ToolTip="Disables URL resolution feature" />
						<StackPanel Margin="20,4,0,0">
							<StackPanel.Style>
								<Style>
									<Setter Property="UIElement.IsEnabled" Value="True" />
									<Style.Triggers>
										<DataTrigger Binding="{Binding Settings.DisableNetworkAccess}" Value="True">
											<Setter Property="UIElement.IsEnabled" Value="False" />
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</StackPanel.Style>
							<StackPanel Orientation="Horizontal">
								<TextBlock Text="URL resolution timeout: " VerticalAlignment="Center" />
								<TextBox Text="{Binding Settings.UrlLookupTimeoutMilliseconds, UpdateSourceTrigger=PropertyChanged}" MinWidth="70" MinHeight="28" Padding="6,4" VerticalAlignment="Center" VerticalContentAlignment="Center" Margin="4,0,0,0" />
								<TextBlock Text=" ms" VerticalAlignment="Center" Margin="2,0,0,0" />
							</StackPanel>
						</StackPanel>
					</StackPanel>
				</Grid>
				</ScrollViewer>
			</TabItem>

			<TabItem Header="Defaults">
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="4">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="*" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<TextBlock Text="Set default browser per domain"  Margin="5" />
					<DataGrid
						ItemsSource="{Binding Defaults}"
						Grid.Row="1"
						AutoGenerateColumns="False"
						RowHeight="32"
						Background="{DynamicResource {x:Static app:App.ContentBackgroundBrushKey}}"
						BorderBrush="{x:Null}"
						CanUserDeleteRows="False"
						CanUserAddRows="False"
						CanUserReorderColumns="False"
						CanUserResizeColumns="False">
						<DataGrid.Columns>
							<DataGridTemplateColumn Header="Match by">
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate DataType="browserPicker:DefaultSetting">
										<ComboBox
											ItemsSource="{Binding DataContext.MatchTypesForRules, RelativeSource={RelativeSource AncestorType=view:Configuration}}"
											IsSynchronizedWithCurrentItem="False"
											SelectedItem="{Binding Type}"
											VerticalContentAlignment="Center" />
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>
							</DataGridTemplateColumn>
							<DataGridTextColumn Header="Pattern" Binding="{Binding Pattern}" Width="*">
								<DataGridTextColumn.ElementStyle>
									<Style TargetType="TextBlock">
										<Setter Property="VerticalAlignment" Value="Center" />
										<Setter Property="Padding" Value="5,0" />
									</Style>
								</DataGridTextColumn.ElementStyle>
							</DataGridTextColumn>
							<DataGridTemplateColumn Header="Browser" Width="*" MinWidth="140" SortMemberPath="Model.Name">
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate DataType="browserPicker:DefaultSetting">
										<ComboBox
											ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=DataGrid}, Path=DataContext.ParentViewModel.Choices}"
											ItemTemplate="{StaticResource BrowserIconAndNameCombo}"
											IsSynchronizedWithCurrentItem="False"
											SelectedValue="{Binding Browser}"
											SelectedValuePath="Model.Id"
											VerticalContentAlignment="Center" />
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>
							</DataGridTemplateColumn>
							<DataGridTemplateColumn>
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate DataType="browserPicker:DefaultSetting">
										<Button Content="X" Command="{Binding Remove}" />
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>
							</DataGridTemplateColumn>
						</DataGrid.Columns>
					</DataGrid>

					<Grid Grid.Row="2" Margin="0,8,0,0">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<ComboBox ItemsSource="{Binding MatchTypesForRules}" SelectedItem="{Binding NewDefaultMatchType}"
							MinHeight="28" MinWidth="100" VerticalContentAlignment="Center" />
						<TextBox Text="{Binding NewDefaultPattern}" Grid.Column="1" MinHeight="28" Padding="6,4" VerticalContentAlignment="Center" Margin="4,0,0,0" />
						<ComboBox
							ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=view:Configuration}, Path=DataContext.ParentViewModel.Choices}"
							ItemTemplate="{StaticResource BrowserIconAndNameCombo}"
							IsSynchronizedWithCurrentItem="False"
							SelectedValue="{Binding NewDefaultBrowser}"
							SelectedValuePath="Model.Id"
							Grid.Column="2" MinHeight="28" MinWidth="160" VerticalContentAlignment="Center" Margin="4,0,0,0" />
						<Button Content="Add" Grid.Column="3" Padding="12,0" MinHeight="28" VerticalAlignment="Stretch" Margin="4,0,0,0" Command="{Binding AddDefault}" />
					</Grid>
				</Grid>
				</ScrollViewer>
			</TabItem>

			<TabItem Header="Test defaults">
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="4">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="*" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition Width="*" />
					</Grid.ColumnDefinitions>
					<TextBlock Text="Url:"  />

					<TextBox Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Text="{Binding TestDefaultsURL, UpdateSourceTrigger=PropertyChanged}" />

					<TextBlock Text="Default browser matched:" Grid.Column="0" Grid.Row="2"  />
					<TextBlock Text="{Binding TestDefaultsResult}" Grid.Column="1" Grid.Row="2" Foreground="LightGreen" />

					<TextBlock Text="Actual browser choice:" Grid.Column="0" Grid.Row="3"  />
					<TextBlock Text="{Binding TestActualResult}" Grid.Column="1" Grid.Row="3" Foreground="LightGreen" />
				</Grid>
				</ScrollViewer>
			</TabItem>

			<TabItem Header="Backup">
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="4">
				<Grid Margin="10" VerticalAlignment="Top">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="*" />
					</Grid.RowDefinitions>
					<TextBlock Text="Back up or restore your BrowserPicker configuration:"  Margin="5" />
					<Button Content="Export BrowserPicker settings" Grid.Row="1" Grid.Column="0" Margin="5" Padding="5" Command="{Binding Backup}" />
					<Button Content="Import BrowserPicker settings" Grid.Row="2" Grid.Column="0" Margin="5" Padding="5" Command="{Binding Restore}" />
					<ScrollViewer Grid.Row="3" Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="5">
						<TextBlock Text="{Binding Settings.BackupLog}"  TextWrapping="Wrap" />
					</ScrollViewer>
				</Grid>
				</ScrollViewer>
			</TabItem>

			<TabItem Header="URL shorteners">
				<Grid Margin="4">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="*" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="*" />
					</Grid.ColumnDefinitions>
					<TextBlock Text="These domains are known URL shorteners and get probed on launch unless disallowed by settings." Grid.ColumnSpan="2" Margin="0,0,0,8" TextWrapping="Wrap" />
					<TextBlock Text="Default shorteners" Grid.Row="1" Grid.Column="0" Margin="0,0,0,4" />
					<TextBlock Text="Additional shorteners" Grid.Row="1" Grid.Column="1" Margin="0,0,0,4" />
					<Grid Grid.Row="2" Grid.ColumnSpan="2" Grid.Column="0" Margin="0,0,0,8">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*" MinWidth="120" />
							<ColumnDefinition Width="8" />
							<ColumnDefinition Width="*" MinWidth="120" />
						</Grid.ColumnDefinitions>
						<ListBox Grid.Column="0" ItemsSource="{Binding DefaultUrlShorteners}" SelectionMode="Single" ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.HorizontalScrollBarVisibility="Disabled" />
						<ListBox Grid.Column="2" ItemsSource="{Binding AdditionalUrlShorteners}" x:Name="UrlShorteners" SelectionMode="Single" ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.HorizontalScrollBarVisibility="Disabled" />
					</Grid>
					<TextBlock Grid.Row="3" Grid.Column="0" FontSize="10" VerticalAlignment="Center" Margin="0,0,8,0">
						<TextBlock.Text>‚ÑπÔ∏è Some additional jump pages not shown above</TextBlock.Text>
						<TextBlock.ToolTip>
							<ToolTip>Some pages, such as outlook safelinks, have special handling where the target url is in the query string; these are not listed here as they require additional information in code.</ToolTip>
						</TextBlock.ToolTip>
					</TextBlock>
					<Grid Grid.Row="3" Grid.Column="1">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<TextBox Text="{Binding NewUrlShortener}" x:Name="NewShortener" Margin="0,0,4,0" />
						<Button Grid.Column="1" Content="Add" Padding="10,0" Command="{Binding AddShortener}" CommandParameter="{Binding Text, ElementName=NewShortener}" />
						<Button Grid.Column="2" Content="Remove" Padding="10,0" Command="{Binding RemoveShortener}" CommandParameter="{Binding SelectedItem, ElementName=UrlShorteners}" />
					</Grid>
				</Grid>
			</TabItem>
			
		</TabControl>

		<StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom">

			<TextBlock Padding="4">
				<TextBlock.Style>
					<Style>
						<Style.Triggers>
							<DataTrigger Binding="{Binding ParentViewModel.Url.TargetURL}" Value="{x:Null}">
								<Setter Property="UIElement.Visibility" Value="Collapsed" />
							</DataTrigger>
						</Style.Triggers>
					</Style>
				</TextBlock.Style>
				<Hyperlink Command="{Binding ParentViewModel.Configure}" >
					<TextBlock Text="Done" />
				</Hyperlink>
			</TextBlock>

			<TextBlock Padding="4">
				<TextBlock.Style>
					<Style>
						<Setter Property="UIElement.Visibility" Value="Collapsed" />
						<Style.Triggers>
							<DataTrigger Binding="{Binding ParentViewModel.Url.TargetURL}" Value="{x:Null}">
								<Setter Property="UIElement.Visibility" Value="Visible" />
							</DataTrigger>
						</Style.Triggers>
					</Style>
				</TextBlock.Style>
				<Hyperlink Command="{Binding ParentViewModel.Exit}" >
					<TextBlock Text="Done" />
				</Hyperlink>
			</TextBlock>

		</StackPanel>

	</Grid>
</UserControl>
